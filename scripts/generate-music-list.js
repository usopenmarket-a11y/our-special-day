import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Get project root (parent of scripts folder)
const projectRoot = path.resolve(__dirname, '..');
const musicDir = path.join(projectRoot, 'public', 'music');
const outputFile = path.join(projectRoot, 'src', 'lib', 'musicList.ts');

// Read all files from public/music directory
function getMusicFiles() {
  try {
    if (!fs.existsSync(musicDir)) {
      console.log('ğŸ“ Creating public/music directory...');
      fs.mkdirSync(musicDir, { recursive: true });
      return [];
    }

    const files = fs.readdirSync(musicDir);
    const mp3Files = files
      .filter(file => file.toLowerCase().endsWith('.mp3'))
      .map(file => {
        // URL encode the filename to handle spaces and special characters
        const encodedFileName = encodeURIComponent(file);
        return `/music/${encodedFileName}`;
      })
      .sort(); // Sort alphabetically

    return mp3Files;
  } catch (error) {
    console.error('Error reading music directory:', error);
    return [];
  }
}

// Generate TypeScript file with music list
function generateMusicList() {
  const musicFiles = getMusicFiles();
  
  const content = `// Auto-generated file - DO NOT EDIT MANUALLY
// This file is automatically generated by scripts/generate-music-list.js
// Run 'npm run generate-music' to regenerate this file

export const musicFiles: string[] = ${JSON.stringify(musicFiles, null, 2)};

// Export for easy access
export default musicFiles;
`;

  fs.writeFileSync(outputFile, content, 'utf-8');
  
  console.log(`âœ… Generated music list with ${musicFiles.length} file(s):`);
  musicFiles.forEach((file, index) => {
    console.log(`   ${index + 1}. ${file}`);
  });
  console.log(`\nğŸ“ Saved to: ${outputFile}`);
}

// Run the generator
generateMusicList();
